/*!
\mainpage notitle

\section overview Thumbnailer API

\subsection intro Introduction

libthumbnailer is the library that offers Qt/C++ direct access to the thumbnailer component in Unity.

The thumbnailer component has an internal centralized component, called the thumbnailer-service, that is
a dbus service listening to requests coming from other processes.
This library wraps those dbus calls and offers an API that can work synchronously and asynchronously.

This document describes how to use the API in both modes, asynchronous and synchronous, withouth dealing with dbus calls.

\section develop Using the Thumbnailer API

\subsection starting Getting started

This simple API has one main class: unity::thumbnailer::Thumbnailer which has the possible methods a programmer may use.
For every method the user obtains a QSharedPointer to a unity::thumbnailer::Request which will emit a unity::thumbnailer::Request::finished signal
when it finishes.

\subsection async Asynchronous API

We provide a simple example showing how to use the API in asynchornous mode, following Qt's design.

\code

class MyClass : public QObject
{
    Q_OBJECT
public:
    MyClass();
    ~MyClass() = default;

    void set_artist_thumbnail_async(QString const& artist, QString const& album, QSize const& size);

public slots:
    void requestFinished();

private:
    unity::thumbnailer::Thumbnailer thumbnailer_;
    QSharedPointer<unity::thumbnailer::Request> request_;
    QImage image_;
}

MyClass::MyClass() : QObject()
{
}

void MyClass::set_artist_thumbnail_async(QString const& artist, QString const& album, QSize const& size)
{
    request_ = thumbnailer_.GetArtistArt(artist, album, size);
    connect(request_.data(), &unity::thumbnailer::Request::finished, this, &MyClass::requestFinished);
}

void MyClass::requestFinished()
{
    if (request_->FinishedSuccessfully())
    {
        // get the image from the request.
        image_ = request_->Image();
    }
    else
    {
        QString errorMessage = request_->ErrorMessage();
        // do whatever you need to do to report the error.
    }
}

\endcode

\subsection sync Synchronous API

For synchronous mode the unity::thumbnailer::Request class exposes a WaitForFinished method, that blocks waiting for the request
to finish.

\code

class MyClass : public QObject
{
    Q_OBJECT
public:
    MyClass();
    ~MyClass() = default;

    void set_album_thumbnail_sync(QString const& artist, QString const& album, QSize const& size);

public slots:
    void requestFinished();

private:
    unity::thumbnailer::Thumbnailer thumbnailer_;
    QImage image_;
}

MyClass::MyClass() : QObject()
{
}

void MyClass::set_album_thumbnail_sync(QString const& artist, QString const& album, QSize const& size)
{
    auto request = thumbnailer_.GetAlbumArt(artist, album, size);

    // block here waiting for the response
    request->WaitForFinished();

    if (request->FinishedSuccessfully())
    {
        // get the image from the request.
        image_ = request->Image();
    }
    else
    {
        QString errorMessage = request->ErrorMessage();
        // do whatever you need to do to report the error.
    }
}

\endcode

Take into account that this use blocks the calling thread, so it may affect Gui threads or general performance.

*/
